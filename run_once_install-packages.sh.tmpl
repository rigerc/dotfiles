#!/bin/bash
# run_once_install-packages.sh.tmpl
# This script runs once to install all required packages

set -e

echo "ðŸ“¦ Installing packages via Homebrew..."

# Update Homebrew
brew update

# Install packages
packages=(
    zsh
    tmux
    zoxide
    fzf
    eza
    bat
    btop
    neovim
    nano
    ripgrep
    fd
    git
    curl
    wget
)

for package in "${packages[@]}"; do
    if brew list "$package" &>/dev/null; then
        echo "âœ“ $package already installed"
    else
        echo "â†’ Installing $package..."
        brew install "$package"
    fi
done

# Install powerlevel10k
if [ ! -d "${HOME}/.oh-my-zsh/custom/themes/powerlevel10k" ]; then
    echo "â†’ Installing Powerlevel10k..."
    git clone --depth=1 https://github.com/romkatv/powerlevel10k.git ${HOME}/.oh-my-zsh/custom/themes/powerlevel10k
fi

# Install Oh My Zsh if not installed
if [ ! -d "${HOME}/.oh-my-zsh" ]; then
    echo "â†’ Installing Oh My Zsh..."
    sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended
fi

# Install zsh-autosuggestions
if [ ! -d "${HOME}/.oh-my-zsh/custom/plugins/zsh-autosuggestions" ]; then
    echo "â†’ Installing zsh-autosuggestions..."
    git clone https://github.com/zsh-users/zsh-autosuggestions ${HOME}/.oh-my-zsh/custom/plugins/zsh-autosuggestions
fi

# Install zsh-syntax-highlighting
if [ ! -d "${HOME}/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting" ]; then
    echo "â†’ Installing zsh-syntax-highlighting..."
    git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${HOME}/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting
fi

# Install fzf key bindings
if [ -f "$(brew --prefix)/opt/fzf/install" ]; then
    echo "â†’ Installing fzf key bindings..."
    $(brew --prefix)/opt/fzf/install --key-bindings --completion --no-update-rc
fi

# Set zsh as default shell
if [ "$SHELL" != "$(which zsh)" ]; then
    echo "â†’ Setting zsh as default shell..."
    chsh -s $(which zsh)
fi

echo "âœ… Package installation complete!"