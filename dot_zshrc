eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"

# Skip global compinit (zinit handles it)
skip_global_compinit=1

# Only run in interactive login shells
   if [[ -o login ]] && command -v fastfetch &> /dev/null; then
     fastfetch
   fi

# History configuration
HISTFILE=~/.zsh_history
HISTSIZE=10000
SAVEHIST=10000
setopt SHARE_HISTORY
setopt HIST_IGNORE_DUPS
setopt HIST_FIND_NO_DUPS
setopt HIST_IGNORE_SPACE      # Don't save commands starting with space
setopt HIST_REDUCE_BLANKS     # Remove superfluous blanks
setopt HIST_VERIFY            # Show command before executing from history
setopt INC_APPEND_HISTORY     # Write immediately, not on exit

# Initialize zinit
ZINIT_HOME="${XDG_DATA_HOME:-${HOME}/.local/share}/zinit/zinit.git"
if [ ! -d "$ZINIT_HOME" ]; then
  mkdir -p "$(dirname $ZINIT_HOME)"
  git clone https://github.com/zdharma-continuum/zinit.git "$ZINIT_HOME"
fi
source "${ZINIT_HOME}/zinit.zsh"

# Load zinit plugins with optimized completion handling
zinit light zdharma-continuum/fast-syntax-highlighting
zinit ice lucid wait='1' atload'_zsh_autosuggest_start'

zinit light zsh-users/zsh-autosuggestions

zstyle ':autocomplete:*' widget-style menu-complete
zstyle ':autocomplete:*' fzf-completion yes
zinit light marlonrichert/zsh-autocomplete

zinit ice lucid wait='1' blockf atpull'zinit creinstall -q .'
zinit light zsh-users/zsh-completions

zinit pack for fzf
zinit ice lucid wait='1' from"gh-r" as"program"

zinit light junegunn/fzf

# fzf-tab
zinit light Aloxaf/fzf-tab
# disable sort when completing `git checkout`
zstyle ':completion:*:git-checkout:*' sort false
# set descriptions format to enable group support
# NOTE: don't use escape sequences (like '%F{red}%d%f') here, fzf-tab will ignore them
zstyle ':completion:*:descriptions' format '[%d]'
# set list-colors to enable filename colorizing
zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS}
# force zsh not to show completion menu, which allows fzf-tab to capture the unambiguous prefix
zstyle ':completion:*' menu no
# preview directory's content with eza when completing cd
zstyle ':fzf-tab:complete:cd:*' fzf-preview 'eza -1 --color=always $realpath'
# custom fzf flags
# NOTE: fzf-tab does not follow FZF_DEFAULT_OPTS by default
zstyle ':fzf-tab:*' fzf-flags --color=fg:1,fg+:2 --bind=tab:accept
# To make fzf-tab follow FZF_DEFAULT_OPTS.
# NOTE: This may lead to unexpected behavior since some flags break this plugin. See Aloxaf/fzf-tab#455.
zstyle ':fzf-tab:*' use-fzf-default-opts yes
# switch group using `<` and `>`
zstyle ':fzf-tab:*' switch-group '<' '>'

# fzf-tmux-popup
zstyle ':fzf-tab:*' fzf-command ftb-tmux-popup

#Starship prompt
zinit ice as"command" from"gh-r" \
          atclone"./starship init zsh > init.zsh; ./starship completions zsh > _starship" \
          atpull"%atclone" src"init.zsh"
zinit light starship/starship

# Eza (modern ls replacement) aliases
if command -v eza &> /dev/null; then
  alias ls='eza --color=always --group-directories-first --icons'
  alias ll='eza -la --icons --octal-permissions --group-directories-first'
  alias l='eza -bGF --header --git --color=always --group-directories-first --icons'
  alias llm='eza -lbGd --header --git --sort=modified --color=always --group-directories-first --icons' 
  alias la='eza --long --all --group --group-directories-first'
  alias lx='eza -lbhHigUmuSa@ --time-style=long-iso --git --color-scale --color=always --group-directories-first --icons'

  alias lS='eza -1 --color=always --group-directories-first --icons'
  alias lt='eza --tree --level=2 --color=always --group-directories-first --icons'
  alias l.="eza -a | grep -E '^\.'"
else
  # Fallback to standard ls if eza is not available
  alias ls="ls -la"
  alias ll="ls -lh"
  alias la="ls -la"
fi


# Zoxide integration (if zoxide is installed)
if command -v zoxide &> /dev/null; then
zinit ice lucid wait='1' as"command" from"gh-r" \
  atclone"./zoxide init zsh --cmd cd > init.zsh" \
  atpull"%atclone" src"init.zsh"
zinit light ajeetdsouza/zoxide

  # zoxide with fzf integration - interactive directory jumping
  if command -v fzf &> /dev/null; then
    # Function to use zoxide with fzf for interactive directory selection
    zif() {
      local dir
      dir=$(zoxide query -l | fzf --height 40% --reverse --prompt="cd> ")
      if [[ -n "$dir" ]]; then
        cd "$dir"
      fi
    }

    # Function to use zoxide with fzf for interactive directory selection with preview
    zif_preview() {
      local dir
      if command -v eza &> /dev/null; then
        dir=$(zoxide query -l | fzf --height 40% --reverse --prompt="cd> " --preview="eza -la --git --icons {}" --preview-window=right:30%)
      else
        dir=$(zoxide query -l | fzf --height 40% --reverse --prompt="cd> " --preview="ls -la {}" --preview-window=right:30%)
      fi
      if [[ -n "$dir" ]]; then
        cd "$dir"
      fi
    }
  fi
fi

# Python virtual environment prompt
export VIRTUAL_ENV_DISABLE_PROMPT=1

# Load custom aliases
if [[ -f "$HOME/.config/zsh/aliases.zsh" ]]; then
    source "$HOME/.config/zsh/aliases.zsh"
fi

# Load tmux integration (auto-start tmux)
if [[ -f "$HOME/.config/zsh/tmux.zsh" ]]; then
    source "$HOME/.config/zsh/tmux.zsh"
fi