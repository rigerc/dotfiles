# Zsh configuration managed by chezmoi
# Place at ~/.local/share/chezmoi/dot_zshrc

# Enable Zsh completion
autoload -Uz compinit && compinit

# History configuration
HISTFILE=~/.zsh_history
HISTSIZE=10000
SAVEHIST=10000
setopt SHARE_HISTORY
setopt HIST_IGNORE_DUPS
setopt HIST_FIND_NO_DUPS

# Initialize zinit
ZINIT_HOME="${XDG_DATA_HOME:-${HOME}/.local/share}/zinit/zinit.git"
if [ ! -d "$ZINIT_HOME" ]; then
  mkdir -p "$(dirname $ZINIT_HOME)"
  git clone https://github.com/zdharma-continuum/zinit.git "$ZINIT_HOME"
fi
source "${ZINIT_HOME}/zinit.zsh"

# Load zinit plugins
zinit ice depth=1; zinit light romkatv/powerlevel10k
zinit light zdharma-continuum/fast-syntax-highlighting
zinit light zsh-users/zsh-autosuggestions
zinit light zsh-users/zsh-completions

# Powerlevel10k configuration
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh

# Fastfetch startup - show system info on shell start
if command -v fastfetch &> /dev/null; then
  fastfetch
fi

# Development tools
export PATH="$HOME/.cargo/bin:$PATH"
export PATH="/opt/homebrew/bin:$PATH"

# Eza (modern ls replacement) aliases
if command -v eza &> /dev/null; then
  alias ls="eza -la --git --icons"
  alias ll="eza -lh --git --icons"
  alias la="eza -la --git --icons"
  alias tree="eza --tree --git --icons"
else
  # Fallback to standard ls if eza is not available
  alias ls="ls -la"
  alias ll="ls -lh"
  alias la="ls -la"
fi

# Zoxide integration (if zoxide is installed)
if command -v zoxide &> /dev/null; then
  eval "$(zoxide init zsh --cmd cd)"

  # zoxide with fzf integration - interactive directory jumping
  if command -v fzf &> /dev/null; then
    # Function to use zoxide with fzf for interactive directory selection
    zi() {
      local dir
      dir=$(zoxide query -l | fzf --height 40% --reverse --prompt="cd> ")
      if [[ -n "$dir" ]]; then
        cd "$dir"
      fi
    }

    # Function to use zoxide with fzf for interactive directory selection with preview
    zi_preview() {
      local dir
      if command -v eza &> /dev/null; then
        dir=$(zoxide query -l | fzf --height 40% --reverse --prompt="cd> " --preview="eza -la --git --icons {}" --preview-window=right:30%)
      else
        dir=$(zoxide query -l | fzf --height 40% --reverse --prompt="cd> " --preview="ls -la {}" --preview-window=right:30%)
      fi
      if [[ -n "$dir" ]]; then
        cd "$dir"
      fi
    }
  fi
fi

# FZF integration (if fzf is installed)
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh


# Node version manager (if using nvm)
# export NVM_DIR="$HOME/.nvm"
# [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"

# Python virtual environment prompt
export VIRTUAL_ENV_DISABLE_PROMPT=1

# Load tmux integration (auto-start tmux)
if [[ -f "{{ .chezmoi.sourceDir }}/dot_config/zsh/tmux.zsh" ]]; then
    source "{{ .chezmoi.sourceDir }}/dot_config/zsh/tmux.zsh"
fi

# Load environment variables
if [[ -f "{{ .chezmoi.sourceDir }}/dot_config/env/development.env" ]]; then
    source "{{ .chezmoi.sourceDir }}/dot_config/env/development.env"
fi

# Additional completion setup
autoload -Uz compinit && compinit -d ~/.cache/zcompdump